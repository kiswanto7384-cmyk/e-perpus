<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Anggota - E-Perpus Pro</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen pb-20">

    <header class="bg-indigo-900 text-white pt-10 pb-20 px-6 rounded-b-[3rem] shadow-xl">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-black italic tracking-tighter uppercase text-yellow-400">Database Anggota ðŸ‘¥</h1>
                <p class="text-[9px] font-bold opacity-60 uppercase tracking-[0.2em]">Registrasi & Aktivasi Kartu Siswa</p>
            </div>
            <button onclick="window.location.href='menu-perpus.html'" class="bg-white/10 p-3 rounded-2xl hover:bg-white/20 font-bold text-xs uppercase">Dashboard</button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-6 -mt-12">
        <div class="bg-white p-6 rounded-[2.5rem] shadow-xl border-t-8 border-indigo-500 mb-8">
            <h2 class="text-xs font-black uppercase text-slate-400 mb-4 tracking-widest italic">Tambah Anggota Baru</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="text" id="nisn" placeholder="NISN (Untuk Barcode)" class="p-4 bg-slate-50 rounded-2xl border-2 border-transparent focus:border-indigo-500 outline-none font-bold text-sm">
                <input type="text" id="nama" placeholder="Nama Lengkap Siswa" class="p-4 bg-slate-50 rounded-2xl border-2 border-transparent focus:border-indigo-500 outline-none font-bold text-sm">
                <select id="kelas" class="p-4 bg-slate-50 rounded-2xl border-2 border-transparent focus:border-indigo-500 outline-none font-bold text-sm">
                    <option value="">Pilih Kelas</option>
                    <option value="1">Kelas 1</option><option value="2">Kelas 2</option>
                    <option value="3">Kelas 3</option><option value="4">Kelas 4</option>
                    <option value="5">Kelas 5</option><option value="6">Kelas 6</option>
                </select>
            </div>
            <button onclick="simpanAnggota()" class="w-full mt-4 bg-indigo-600 text-white py-4 rounded-2xl font-black uppercase italic shadow-lg hover:bg-indigo-700 transition-all">Daftarkan Anggota ðŸš€</button>
        </div>

        <div class="mb-4">
            <input type="text" id="cariAnggota" onkeyup="filterAnggota()" placeholder="Cari Nama atau NISN..." class="w-full p-4 rounded-2xl border-none shadow-sm font-bold text-sm outline-none text-indigo-900" >
        </div>

        <div class="bg-white rounded-[2.5rem] shadow-xl overflow-hidden border border-slate-100">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-indigo-50 text-[10px] font-black uppercase text-indigo-900 tracking-widest">
                        <tr>
                            <th class="p-5">Siswa</th>
                            <th class="p-5">NISN</th>
                            <th class="p-5 text-center">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="tabelAnggota" class="text-sm font-bold text-slate-600">
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // CONFIG FIREBASE (SAMA DENGAN KASIR)
        const firebaseConfig = {
            apiKey: "AIzaSyCUjE8WXa8Py4vnojrXDUR3uCvnQEzP6zQ",
            authDomain: "e-kantin-91f0c.firebaseapp.com",
            databaseURL: "https://e-kantin-91f0c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "e-kantin-91f0c",
            storageBucket: "e-kantin-91f0c.firebasestorage.app",
            messagingSenderId: "981834126006",
            appId: "1:981834126006:web:dac8bb0ec1da90549b4c17"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function simpanAnggota() {
            const nisn = document.getElementById('nisn').value;
            const nama = document.getElementById('nama').value;
            const kelas = document.getElementById('kelas').value;

            if(!nisn || !nama || !kelas) return alert("Lengkapi semua data, Pak!");

            db.ref('perpus_anggota/' + nisn).set({
                nama: nama,
                kelas: kelas,
                tgl_daftar: new Date().toLocaleDateString('id-ID')
            }).then(() => {
                alert("Anggota Berhasil Disimpan!");
                document.getElementById('nisn').value = "";
                document.getElementById('nama').value = "";
                document.getElementById('kelas').value = "";
            });
        }

        db.ref('perpus_anggota').on('value', snap => {
            const tbody = document.getElementById('tabelAnggota');
            tbody.innerHTML = "";
            snap.forEach(s => {
                const a = s.val();
                tbody.innerHTML += `
                    <tr class="border-t border-slate-50 hover:bg-slate-50 transition-all">
                        <td class="p-5">
                            <p class="font-black text-slate-800 uppercase text-xs">${a.nama}</p>
                            <p class="text-[9px] text-indigo-500 font-bold uppercase">Kelas ${a.kelas}</p>
                        </td>
                        <td class="p-5 font-mono text-xs text-slate-400">${s.key}</td>
                        <td class="p-5 text-center">
                            <div class="flex justify-center gap-2">
                                <button onclick="hapusAnggota('${s.key}')" class="bg-red-50 text-red-500 p-2 px-4 rounded-xl text-[10px] font-black hover:bg-red-500 hover:text-white">HAPUS</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
        });

        function hapusAnggota(id) {
            if(confirm("Hapus anggota ini dari sistem?")) {
                db.ref('perpus_anggota/' + id).remove();
            }
        }

        function filterAnggota() {
            let input = document.getElementById("cariAnggota").value.toUpperCase();
            let tr = document.getElementById("tabelAnggota").getElementsByTagName("tr");
            for (let i = 0; i < tr.length; i++) {
                let td = tr[i].getElementsByTagName("td")[0];
                if (td) {
                    let txtValue = td.textContent || td.innerText;
                    tr[i].style.display = txtValue.toUpperCase().indexOf(input) > -1 ? "" : "none";
                }
            }
        }
    </script>
</body>
</html>

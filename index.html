<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallpaper E-Perpus - SDN 169</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @keyframes slow-zoom { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .bg-animate { animation: slow-zoom 20s infinite ease-in-out; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        
        /* Slide Logic */
        .slide { display: none; transition: opacity 1s ease-in-out; }
        .slide.active { display: flex; opacity: 1; }
    </style>
</head>
<body class="bg-slate-900 min-h-screen overflow-hidden text-white cursor-pointer" onclick="tampilLogin()">
    
    <div class="fixed inset-0 z-0">
        <img src="https://images.unsplash.com/photo-1507842217343-583bb7270b66?q=80&w=2000" class="w-full h-full object-cover opacity-30 bg-animate">
        <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-slate-900"></div>
    </div>

    <div id="slide1" class="slide active relative z-10 flex flex-col items-center justify-between min-h-screen p-8 pb-16 pointer-events-none">
        <div class="text-center mt-10">
            <h2 id="clock" class="text-7xl font-black tracking-tighter shadow-xl">00:00</h2>
            <p id="date" class="text-xs font-bold uppercase tracking-[0.4em] opacity-70 mt-2">Memuat Tanggal...</p>
        </div>

        <div class="w-full max-w-md">
            <div class="text-center mb-6">
                <span class="bg-yellow-500 text-slate-900 px-4 py-1 rounded-full text-[10px] font-black uppercase tracking-widest shadow-lg">ğŸ† Duta Literasi Terajin</span>
            </div>
            <div id="podium" class="flex items-end justify-around h-48 mb-4">
                </div>
        </div>

        <div class="text-center animate-bounce opacity-50 font-black text-[10px] uppercase tracking-[0.3em]">Ketuk Layar Untuk Masuk ğŸ‘†</div>
    </div>

    <div id="slide2" class="slide relative z-10 flex flex-col items-center justify-center min-h-screen p-6 pointer-events-none">
        <div class="w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="glass p-6 rounded-[2rem]">
                <h3 class="text-[10px] font-black uppercase tracking-widest mb-4 text-yellow-400">ğŸ“Š Kunjungan Per Kelas</h3>
                <canvas id="chartKelas" height="200"></canvas>
            </div>
            <div class="glass p-6 rounded-[2rem]">
                <h3 class="text-[10px] font-black uppercase tracking-widest mb-4 text-indigo-400">ğŸ“ˆ Tren Sirkulasi</h3>
                <canvas id="chartSirkulasi" height="200"></canvas>
            </div>
        </div>
        <div class="mt-8 text-center bg-white/10 px-6 py-2 rounded-full backdrop-blur-sm">
            <p id="statRingkasan" class="text-[9px] font-black uppercase tracking-widest opacity-80">Memuat Ringkasan Data...</p>
        </div>
    </div>

    <div id="modalLogin" class="fixed inset-0 z-50 flex items-center justify-center p-6 bg-slate-950/80 backdrop-blur-sm hidden">
        <div class="bg-white text-slate-900 w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl pointer-events-auto" onclick="event.stopPropagation()">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">ğŸ”</div>
                <h2 class="text-2xl font-black italic uppercase">Akses Petugas</h2>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-none mt-1">SDN 169 CINTA DAMAI</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-[9px] font-black uppercase ml-4 text-slate-400">Email Admin</label>
                    <input type="email" id="email" value="sdn169.cintadamai@gmail.com" readonly class="w-full bg-slate-100 p-4 rounded-2xl font-bold text-sm outline-none border-2 border-transparent">
                </div>
                <div>
                    <label class="text-[9px] font-black uppercase ml-4 text-slate-400">Password</label>
                    <input type="password" id="pass" placeholder="Masukkan Password..." class="w-full bg-slate-100 p-4 rounded-2xl font-bold text-sm border-2 border-transparent focus:border-indigo-500 outline-none transition-all">
                </div>
                
                <div class="pt-2">
                    <button onclick="verifikasiLogin()" class="w-full bg-indigo-600 text-white font-black py-4 rounded-2xl shadow-lg hover:bg-indigo-700 transition-all uppercase text-xs italic tracking-widest">Masuk Sekarang ğŸš€</button>
                    <button onclick="tutupLogin()" class="w-full text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-6">Kembali</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://e-perpus-a652c-default-rtdb.asia-southeast1.firebasedatabase.app" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. JAM & TANGGAL
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('date').innerText = now.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        }
        setInterval(updateClock, 1000); updateClock();

        // 2. LOGIKA SLIDE (10 DETIK)
        let currentSlide = 1;
        setInterval(() => {
            document.getElementById('slide1').classList.toggle('active');
            document.getElementById('slide2').classList.toggle('active');
        }, 10000);

        // 3. LOGIN LOGIC
        function tampilLogin() { document.getElementById('modalLogin').classList.remove('hidden'); document.getElementById('pass').focus(); }
        function tutupLogin() { document.getElementById('modalLogin').classList.add('hidden'); }
        function verifikasiLogin() {
            const p = document.getElementById('pass').value;
            if(p === "Cintadama1" || p === "7384") {
                sessionStorage.setItem("aksesEPerpus", "true");
                window.location.href = 'menu-perpus.html';
            } else { alert("Salah Pak!"); }
        }

        // 4. DATA GRAFIK & PODIUM
        let chartKelas, chartSirkulasi;
        function initCharts() {
            const commonOptions = { responsive: true, plugins: { legend: { display: false } }, scales: { y: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#fff' } }, x: { ticks: { color: '#fff' } } } };
            
            chartKelas = new Chart(document.getElementById('chartKelas'), {
                type: 'bar',
                data: { labels: [], datasets: [{ backgroundColor: '#fbbf24', data: [], borderRadius: 5 }] },
                options: commonOptions
            });

            chartSirkulasi = new Chart(document.getElementById('chartSirkulasi'), {
                type: 'line',
                data: { labels: [], datasets: [{ borderColor: '#6366f1', data: [], tension: 0.4, fill: true, backgroundColor: 'rgba(99,102,241,0.2)' }] },
                options: commonOptions
            });
        }

        db.ref('perpus_laporan').on('value', snap => {
            if(!snap.exists()) return;
            const data = snap.val();
            const counts = {};
            const kunjunganKelas = {};
            const trenSirkulasi = {};
            let total = 0, aktif = 0;

            Object.values(data).forEach(d => {
                total++;
                if(d.status === "DIPINJAM") aktif++;
                // Podium
                if(d.namaSiswa) counts[d.namaSiswa] = (counts[d.namaSiswa] || 0) + 1;
                // Kelas
                const kls = d.kelas || "N/A";
                kunjunganKelas[kls] = (kunjunganKelas[kls] || 0) + 1;
                // Tren
                const tgl = d.waktuPinjam ? d.waktuPinjam.split(',')[0] : "Lama";
                trenSirkulasi[tgl] = (trenSirkulasi[tgl] || 0) + 1;
            });

            // Update Podium
            const sorted = Object.keys(counts).map(n => ({ nama: n, total: counts[n] })).sort((a,b) => b.total - a.total).slice(0,3);
            const order = [sorted[1], sorted[0], sorted[2]];
            document.getElementById('podium').innerHTML = order.map((s,i) => {
                if(!s) return `<div class="w-1/3"></div>`;
                const isFirst = s.nama === sorted[0].nama;
                return `<div class="flex flex-col items-center w-1/3 px-1"><div class="glass ${isFirst ? 'h-32 border-yellow-500/50' : 'h-24'} w-full rounded-2xl flex flex-col items-center justify-center transition-all"><span class="text-xl">${isFirst ? 'ğŸ¥‡' : (i === 0 ? 'ğŸ¥ˆ' : 'ğŸ¥‰')}</span><p class="text-[8px] font-black uppercase truncate w-full px-2 text-center">${s.nama}</p><p class="text-xl font-black text-yellow-400">${s.total}</p></div></div>`;
            }).join('');

            // Update Charts
            chartKelas.data.labels = Object.keys(kunjunganKelas);
            chartKelas.data.datasets[0].data = Object.values(kunjunganKelas);
            chartKelas.update();

            const tglLabels = Object.keys(trenSirkulasi).slice(-5);
            chartSirkulasi.data.labels = tglLabels;
            chartSirkulasi.data.datasets[0].data = tglLabels.map(t => trenSirkulasi[t]);
            chartSirkulasi.update();

            document.getElementById('statRingkasan').innerText = `TOTAL SIRKULASI: ${total} | MASIH DIPINJAM: ${aktif} | SELESAI: ${total - aktif}`;
        });

        window.onload = () => { initCharts(); };
    </script>
</body>
</html>

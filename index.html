<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Perpus - Digital Signage</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slow-zoom {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .bg-animate {
            animation: slow-zoom 20s infinite ease-in-out;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-slate-900 min-h-screen overflow-hidden text-white font-sans cursor-pointer" onclick="location.href='menu-perpus.html'">

    <div class="fixed inset-0 z-0">
        <img src="https://images.unsplash.com/photo-1507842217343-583bb7270b66?q=80&w=2000" 
             class="w-full h-full object-cover opacity-40 bg-animate" alt="Library Background">
        <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-slate-900"></div>
    </div>

    <div class="relative z-10 flex flex-col items-center justify-between min-h-screen p-8 pb-16">
        
        <div class="text-center mt-10">
            <h2 id="clock" class="text-6xl font-black tracking-tighter">00:00</h2>
            <p class="text-xs font-bold uppercase tracking-[0.4em] opacity-70">Senin, 02 Februari 2026</p>
        </div>

        <div class="w-full max-w-md">
            <div class="text-center mb-6">
                <span class="bg-yellow-500 text-slate-900 px-4 py-1 rounded-full text-[10px] font-black uppercase tracking-widest shadow-lg">üèÜ Duta Literasi Minggu Ini</span>
            </div>
            
            <div id="podiumWallpaper" class="flex items-end justify-around h-48 mb-4">
                </div>
        </div>

        <div class="text-center animate-bounce">
            <p class="text-[10px] font-black uppercase tracking-[0.3em] opacity-50">Ketuk layar untuk masuk ke Dashboard üëÜ</p>
        </div>
    </div>

    <script>
        // CONFIG FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyBXt0gEgczYD1jQ9OhNk5FGN8CePIFaSYw",
            authDomain: "e-perpus-a652c.firebaseapp.com",
            databaseURL: "https://e-perpus-a652c-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "e-perpus-a652c"
        };
        
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Update Jam Realtime
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Ambil Data Peringkat
        db.ref('perpus_laporan').on('value', snap => {
            const data = snap.val();
            if (!data) return;

            const counts = {};
            Object.values(data).forEach(log => {
                const key = log.namaSiswa;
                counts[key] = (counts[key] || 0) + 1;
            });

            const sorted = Object.keys(counts).map(nama => ({
                nama, total: counts[nama]
            })).sort((a, b) => b.total - a.total).slice(0, 3);

            renderPodium(sorted);
        });

        function renderPodium(top3) {
            const podiumEl = document.getElementById('podiumWallpaper');
            if(top3.length < 1) return;
            
            // Urutan 2, 1, 3
            const displayOrder = [top3[1], top3[0], top3[2]];
            
            podiumEl.innerHTML = displayOrder.map((s, i) => {
                if(!s) return `<div class="w-1/3"></div>`;
                const isFirst = s.nama === top3[0].nama;
                const height = isFirst ? 'h-32' : (i === 0 ? 'h-24' : 'h-20');
                const glow = isFirst ? 'shadow-[0_0_30px_rgba(234,179,8,0.3)]' : '';
                
                return `
                    <div class="flex flex-col items-center w-1/3 px-1">
                        <div class="glass-effect ${height} w-full rounded-2xl flex flex-col items-center justify-center border-white/20 ${glow}">
                            <span class="${isFirst ? 'text-3xl' : 'text-xl'} mb-1">${isFirst ? 'ü•á' : (i === 0 ? 'ü•à' : 'ü•â')}</span>
                            <p class="text-[9px] font-black uppercase truncate w-full px-2 text-center">${s.nama}</p>
                            <p class="text-xl font-black mt-1">${s.total}</p>
                            <p class="text-[7px] font-bold opacity-50 uppercase">Buku</p>
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>
</body>
</html>

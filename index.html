<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallpaper E-Perpus</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slow-zoom { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .bg-animate { animation: slow-zoom 20s infinite ease-in-out; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="bg-slate-900 min-h-screen overflow-hidden text-white cursor-pointer">
    
    <div class="fixed inset-0 z-0" onclick="tampilLogin()">
        <img src="https://images.unsplash.com/photo-1507842217343-583bb7270b66?q=80&w=2000" class="w-full h-full object-cover opacity-40 bg-animate">
        <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-slate-900"></div>
    </div>

    <div class="relative z-10 flex flex-col items-center justify-between min-h-screen p-8 pb-16 pointer-events-none">
        <div class="text-center mt-10">
            <h2 id="clock" class="text-6xl font-black tracking-tighter">00:00</h2>
            <p id="date" class="text-xs font-bold uppercase tracking-[0.4em] opacity-70">Memuat Tanggal...</p>
        </div>

        <div class="w-full max-w-md">
            <div class="text-center mb-6">
                <span class="bg-yellow-500 text-slate-900 px-4 py-1 rounded-full text-[10px] font-black uppercase tracking-widest shadow-lg">ğŸ† Duta Literasi Terajin</span>
            </div>
            <div id="podium" class="flex items-end justify-around h-48 mb-4"></div>
        </div>

        <div class="text-center animate-bounce opacity-50 font-black text-[10px] uppercase tracking-[0.3em]">Ketuk Layar Untuk Masuk ğŸ‘†</div>
    </div>

    <div id="modalLogin" class="fixed inset-0 z-50 flex items-center justify-center p-6 bg-slate-950/80 backdrop-blur-sm hidden">
        <div class="bg-white text-slate-900 w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl pointer-events-auto">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-black italic uppercase">Akses Petugas</h2>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Verifikasi Keamanan OTP</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-[9px] font-black uppercase ml-4 text-slate-400">Email Admin</label>
                    <input type="email" id="email" value="sdn169.cintadamai@gmail.com" readonly class="w-full bg-slate-100 p-4 rounded-2xl font-bold text-sm outline-none">
                </div>
                <div>
                    <label class="text-[9px] font-black uppercase ml-4 text-slate-400">Password</label>
                    <input type="password" id="pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="w-full bg-slate-100 p-4 rounded-2xl font-bold text-sm border-none focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
                <button onclick="mintaOTP()" class="w-full bg-indigo-600 text-white font-black py-4 rounded-2xl shadow-lg hover:bg-indigo-700 transition-all uppercase text-xs italic">Generate OTP</button>
                
                <hr class="border-slate-100">
                
                <div>
                    <label class="text-[9px] font-black uppercase ml-4 text-slate-400">6-Digit OTP (Cek Monitoring)</label>
                    <input type="number" id="otpInput" placeholder="000000" class="w-full bg-slate-50 border-2 border-dashed border-slate-200 p-4 rounded-2xl font-black text-center text-xl tracking-[0.5em] focus:ring-2 focus:ring-yellow-500 outline-none">
                </div>
                
                <button onclick="verifikasiLogin()" class="w-full bg-yellow-500 text-slate-900 font-black py-4 rounded-2xl shadow-lg hover:bg-yellow-400 transition-all uppercase text-xs italic">Masuk Dashboard âœ…</button>
                <button onclick="tutupLogin()" class="w-full text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-2">Batal</button>
            </div>
        </div>
    </div>

    <script>
        // FIREBASE CONFIG
        const firebaseConfig = { databaseURL: "https://e-perpus-a652c-default-rtdb.asia-southeast1.firebasedatabase.app" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 1. JAM & TANGGAL
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('date').innerText = now.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        }
        setInterval(updateClock, 1000); updateClock();

        // 2. MODAL CONTROL
        function tampilLogin() { document.getElementById('modalLogin').classList.remove('hidden'); }
        function tutupLogin() { document.getElementById('modalLogin').classList.add('hidden'); }

        // 3. LOGIKA OTP
        function mintaOTP() {
            const pass = document.getElementById('pass').value;
            if(pass === "Cintadama1") {
                const kode = Math.floor(100000 + Math.random() * 900000);
                
                // Simpan ke Firebase agar Admin/Guru bisa cek di menu Monitoring
                db.ref('admin_otp').set({
                    otp: kode,
                    timestamp: Date.now(),
                    email: "sdn169.cintadamai@gmail.com"
                }).then(() => {
                    alert("KODE OTP BERHASIL DIBUAT!\n\nKode: " + kode + "\n\n(Catatan: Di sistem asli, kode ini otomatis terkirim ke email/monitoring guru)");
                });
            } else {
                alert("Password Salah!");
            }
        }

        function verifikasiLogin() {
            const input = document.getElementById('otpInput').value;

            // PINTU DARURAT (Gunakan jika tidak ada internet/email macet)
            if (input === "7384") {
                sessionStorage.setItem("aksesEPerpus", "true");
                window.location.href = 'menu-perpus.html';
                return;
            }

            db.ref('admin_otp/otp').once('value', snap => {
                if(input == snap.val()) {
                    sessionStorage.setItem("aksesEPerpus", "true");
                    window.location.href = 'menu-perpus.html';
                } else {
                    alert("Kode OTP Salah atau Belum Di-generate!");
                }
            });
        }

        // 4. DATA PODIUM
        db.ref('perpus_laporan').on('value', snap => {
            const counts = {};
            snap.forEach(c => { const d = c.val(); counts[d.namaSiswa] = (counts[d.namaSiswa] || 0) + 1; });
            const sorted = Object.keys(counts).map(n => ({ nama: n, total: counts[n] })).sort((a,b) => b.total - a.total).slice(0,3);
            const podiumEl = document.getElementById('podium');
            const order = [sorted[1], sorted[0], sorted[2]];
            podiumEl.innerHTML = order.map((s,i) => {
                if(!s) return `<div class="w-1/3"></div>`;
                const isFirst = s.nama === sorted[0].nama;
                return `<div class="flex flex-col items-center w-1/3 px-1 pointer-events-auto">
                    <div class="glass ${isFirst ? 'h-32 shadow-yellow-500/20' : 'h-24'} w-full rounded-2xl flex flex-col items-center justify-center">
                        <span class="text-xl">${isFirst ? 'ğŸ¥‡' : (i === 0 ? 'ğŸ¥ˆ' : 'ğŸ¥‰')}</span>
                        <p class="text-[8px] font-black uppercase truncate w-full px-2 text-center">${s.nama}</p>
                        <p class="text-xl font-black">${s.total}</p>
                    </div>
                </div>`;
            }).join('');
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallpaper E-Perpus</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slow-zoom { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .bg-animate { animation: slow-zoom 20s infinite ease-in-out; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="bg-slate-900 min-h-screen overflow-hidden text-white cursor-pointer">
    
    <div class="fixed inset-0 z-0" onclick="tampilLogin()">
        <img src="https://images.unsplash.com/photo-1507842217343-583bb7270b66?q=80&w=2000" class="w-full h-full object-cover opacity-40 bg-animate">
        <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-slate-900"></div>
    </div>

    <div class="relative z-10 flex flex-col items-center justify-between min-h-screen p-8 pb-16 pointer-events-none">
        <div class="text-center mt-10">
            <h2 id="clock" class="text-6xl font-black tracking-tighter shadow-xl">00:00</h2>
            <p id="date" class="text-xs font-bold uppercase tracking-[0.4em] opacity-70 mt-2">Memuat Tanggal...</p>
        </div>

        <div class="w-full max-w-md">
            <div class="text-center mb-6">
                <span class="bg-yellow-500 text-slate-900 px-4 py-1 rounded-full text-[10px] font-black uppercase tracking-widest shadow-lg">üèÜ Duta Literasi Terajin</span>
            </div>
            <div id="podium" class="flex items-end justify-around h-48 mb-4">
                </div>
        </div>

        <div class="text-center animate-bounce opacity-50 font-black text-[10px] uppercase tracking-[0.3em]">Ketuk Layar Untuk Masuk üëÜ</div>
    </div>

    <div id="modalLogin" class="fixed inset-0 z-50 flex items-center justify-center p-6 bg-slate-950/80 backdrop-blur-sm hidden">
        <div class="bg-white text-slate-900 w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl pointer-events-auto">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">üîê</div>
                <h2 class="text-2xl font-black italic uppercase">Akses Petugas</h2>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest leading-none mt-1">SDN 165 TANJUNG JABUNG</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-[9px] font-black uppercase ml-4 text-slate-400">Email Admin</label>
                    <input type="email" id="email" value="sdn169.cintadamai@gmail.com" readonly class="w-full bg-slate-100 p-4 rounded-2xl font-bold text-sm outline-none border-2 border-transparent focus:border-indigo-500 transition-all">
                </div>
                <div>
                    <label class="text-[9px] font-black uppercase ml-4 text-slate-400">Password</label>
                    <input type="password" id="pass" placeholder="Masukkan Password..." class="w-full bg-slate-100 p-4 rounded-2xl font-bold text-sm border-2 border-transparent focus:border-indigo-500 outline-none transition-all">
                </div>
                
                <div class="pt-2">
                    <button onclick="verifikasiLogin()" class="w-full bg-indigo-600 text-white font-black py-4 rounded-2xl shadow-lg hover:bg-indigo-700 transition-all uppercase text-xs italic tracking-widest">Masuk Sekarang üöÄ</button>
                    <button onclick="tutupLogin()" class="w-full text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-6 hover:text-red-500 transition-colors">Kembali</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. FIREBASE SETUP
        const firebaseConfig = { databaseURL: "https://e-perpus-a652c-default-rtdb.asia-southeast1.firebasedatabase.app" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. JAM & TANGGAL (REALTIME)
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('date').innerText = now.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        }
        setInterval(updateClock, 1000); updateClock();

        // 3. KONTROL MODAL
        function tampilLogin() { 
            document.getElementById('modalLogin').classList.remove('hidden'); 
            document.getElementById('pass').focus();
        }
        function tutupLogin() { document.getElementById('modalLogin').classList.add('hidden'); }

        // 4. LOGIKA LOGIN (TANPA OTP)
        function verifikasiLogin() {
            const passInput = document.getElementById('pass').value;

            // Password sesuai permintaan Bapak atau Master Key
            if(passInput === "Cintadama1" || passInput === "7384") {
                sessionStorage.setItem("aksesEPerpus", "true");
                
                // Animasi sebelum pindah halaman
                document.querySelector('#modalLogin div').innerHTML = "<div class='text-center p-10'><div class='animate-spin text-4xl mb-4'>üåÄ</div><p class='font-black italic uppercase'>Membuka Dashboard...</p></div>";
                
                setTimeout(() => {
                    window.location.href = 'menu-perpus.html';
                }, 800);
            } else {
                alert("Password Salah, Pak!");
                document.getElementById('pass').value = "";
            }
        }

        // 5. DATA PODIUM (Duta Literasi)
        db.ref('perpus_laporan').on('value', snap => {
            const counts = {};
            if(!snap.exists()) return;

            snap.forEach(c => { 
                const d = c.val(); 
                if(d.namaSiswa) counts[d.namaSiswa] = (counts[d.namaSiswa] || 0) + 1; 
            });

            const sorted = Object.keys(counts)
                .map(n => ({ nama: n, total: counts[n] }))
                .sort((a,b) => b.total - a.total)
                .slice(0,3);

            const podiumEl = document.getElementById('podium');
            // Urutan podium: 2 - 1 - 3
            const order = [sorted[1], sorted[0], sorted[2]];
            
            podiumEl.innerHTML = order.map((s,i) => {
                if(!s) return `<div class="w-1/3"></div>`;
                const isFirst = s.nama === sorted[0].nama;
                return `
                <div class="flex flex-col items-center w-1/3 px-1 pointer-events-auto">
                    <div class="glass ${isFirst ? 'h-32 border-yellow-500/50' : 'h-24'} w-full rounded-2xl flex flex-col items-center justify-center transition-all duration-500">
                        <span class="text-xl mb-1">${isFirst ? 'ü•á' : (i === 0 ? 'ü•à' : 'ü•â')}</span>
                        <p class="text-[8px] font-black uppercase truncate w-full px-2 text-center text-white/90">${s.nama}</p>
                        <p class="text-xl font-black text-yellow-400">${s.total}</p>
                    </div>
                </div>`;
            }).join('');
        });
    </script>
</body>
</html>
